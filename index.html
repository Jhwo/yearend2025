<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>지속하는 힘 문장 뽑기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- KkuBulLim Font (마지막 문장용) -->
  <style>
    @font-face {
      font-family: 'KkuBulLim';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2410-1@1.0/BMkkubulimTTF-Regular.woff2') format('woff2');
      font-weight: normal;
      font-display: swap;
    }
  </style>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet"/>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root {
      --bg:#f2f2f2;
      --orange:#ff5b35;
      --gray:#343434;

      --font-main:"Gowun Dodum",sans-serif;
      --font-ui:"Noto Sans KR",sans-serif;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      background:var(--bg);
      display:flex;
      justify-content:center;
      font-family:var(--font-main);
      overflow:hidden; /* 전체 스크롤 방지 */
    }

    .app{
      width:100%;
      max-width:480px;
      height:100vh;
      padding:40px 24px;
      position:relative;
      overflow-x:hidden;
      overflow-y:auto;
      background:var(--bg);
    }

    .app.no-scroll{
      overflow-y:hidden;
    }

    .app.hide-logo .logo-area{
      display:none;
    }

    .bottom-gradient{
      position:absolute;
      left:0;
      bottom:0;
      width:100%;
      height:220px;
      background:linear-gradient(to bottom,#f2f2f2 0%,#ff5b35 100%);
      z-index:0;
      pointer-events:none;
    }

    .logo-area{
      position:fixed;
      bottom:18px;
      left:50%;
      transform:translateX(-50%);
      z-index:3;
      pointer-events:none;
      width:100%;
      max-width:480px;
      text-align:center;
    }
    .logo-area img{ height:40px; }

    .screen{
      display:none;
      text-align:center;
      color:var(--gray);
      position:relative;
      z-index:2;
      min-height:100%;
      padding-bottom:40px;
    }

    .screen.active{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:24px;
    }

    /* 상단 영역 */
    .top-star{
      margin-top:70px;
      width:100%;
      display:flex;
      justify-content:center;
    }
    .top-star img{ width:34px; height:34px; }

    .top-visual{
      margin-top:18px;
      width:100%;
      display:flex;
      justify-content:center;
    }
    .top-gif{
      width:90%;
      max-width:360px;
      height:auto;
    }

    /* GIF 버튼 */
    .gif-btn-wrap{
      margin-top:40px;
      width:100%;
      display:flex;
      justify-content:center;
    }

    .gif-btn{
      height:60px;
      width:auto;
      cursor:pointer;
    }

    /* 버튼 */
    .btn{
      height:60px;
      padding:0 28px;
      background:var(--orange);
      color:#fff;
      border:none;
      border-radius:14px;
      font-family:var(--font-ui);
      font-size:25px;
      cursor:pointer;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .btn-secondary{
      background:#3A3A3A;
    }

    /* 도형 페이지 */
    .shapes-wrapper{
      width:100%;
      display:flex;
      justify-content:center;
    }

    .shapes-canvas{
      position:relative;
      width:100%;
      max-width:430px;
      height:420px;
      margin:-20px auto 0;
    }

    .shape{
      position:absolute;
      width:120px;
      height:120px;
      cursor:pointer;
    }

    .shape img{
      width:100%;
      height:100%;
    }

    /* float animations */
    .shape.s1{ animation:float1 4s ease-in-out infinite alternate; }
    .shape.s2{ animation:float2 4.2s ease-in-out infinite alternate; }
    .shape.s3{ animation:float3 3.8s ease-in-out infinite alternate; }
    .shape.s4{ animation:float4 4.4s ease-in-out infinite alternate; }

    @keyframes float1{ 0%{transform:translate(-5px,4px);}100%{transform:translate(5px,-4px);} }
    @keyframes float2{ 0%{transform:translate(5px,-4px);}100%{transform:translate(-5px,4px);} }
    @keyframes float3{ 0%{transform:translate(-5px,-4px);}100%{transform:translate(5px,4px);} }
    @keyframes float4{ 0%{transform:translate(5px,4px);}100%{transform:translate(-4px,-4px);} }

    /* 로딩 */
    .loader{
      width:60px; height:60px;
      border-radius:50%;
      border:2px solid transparent;
      border-top-color:var(--orange);
      border-right-color:var(--orange);
      animation:spin 1s linear infinite;
      transform:rotate(45deg);
      margin-top:20px;
    }
    @keyframes spin{ to{transform:rotate(405deg);} }

    /* ===== STEP 5 결과 페이지 ===== */
    #step-5{
      padding-top:70px;
      padding-bottom:0;
      gap:20px;
      justify-content:flex-start;
      min-height:100%;
    }

    /* ★ 마지막 문장 (화면용) */
    .quote{
      font-size:32px;
      line-height:52px;
      max-width:90%;
      text-align:center;
      font-family:'KkuBulLim', sans-serif;
      color:#343434;
      margin-top:0;
    }

    .result-logo img{
      height:40px;
      margin-top:10px;
    }

    .result-buttons{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
      width:100%;
      margin-bottom:20px;
    }

    .result-buttons .btn{
      width:80%;
      max-width:320px;
    }

    /* ===== 저장 이미지 ===== */
    #save-layout{
      position:absolute;
      left:-9999px;
      top:0;
      width:360px;
      background:linear-gradient(
        to bottom,
        #f2f2f2 0%,
        #f2f2f2 55%,
        #ff5b35 100%
      );
      padding:40px 24px 0;
    }

    /* ★ 저장 이미지 글귀 */
    #save-quote{
      font-size:26px;
      line-height:42px;
      max-width:90%;
      margin:0 auto;
      text-align:center;
      font-family:'KkuBulLim', sans-serif;
      color:#343434;
    }

    #save-logo img{
      height:40px;
      display:block;
      margin:40px auto;
    }
  </style>
</head>

<body>
<div class="app">

  <!-- STEP 1 -->
  <section class="screen active" id="step-1">
    <div class="top-star"><img src="star.png"></div>
    <div class="top-visual"><img src="q01.gif" class="top-gif"></div>
    <div class="gif-btn-wrap"><img src="btn_1.gif" class="gif-btn" onclick="goToStep(2)"></div>
  </section>

  <!-- STEP 2 -->
  <section class="screen" id="step-2">
    <div class="top-star"><img src="star.png"></div>
    <div class="top-visual"><img src="q02.gif" class="top-gif"></div>
    <button class="btn" onclick="goToStep(3)">고민을 떠올렸으면 누르기</button>
  </section>

  <!-- STEP 3 -->
  <section class="screen" id="step-3">
    <div class="top-star"><img src="star.png"></div>
    <div class="top-visual"><img src="q03.gif" class="top-gif"></div>

    <div class="shapes-wrapper">
      <div class="shapes-canvas">

        <div class="shape s1" style="left:0%; top:6%;" onclick="pickShape()"><img src="shape02.gif"></div>
        <div class="shape s2" style="left:35%; top:2%;" onclick="pickShape()"><img src="shape03.gif"></div>
        <div class="shape s3" style="left:70%; top:8%;" onclick="pickShape()"><img src="shape01.gif"></div>

        <div class="shape s4" style="left:15%; top:28%;" onclick="pickShape()"><img src="shape03.gif"></div>
        <div class="shape s1" style="left:50%; top:24%;" onclick="pickShape()"><img src="shape04.gif"></div>
        <div class="shape s2" style="left:80%; top:30%;" onclick="pickShape()"><img src="shape02.gif"></div>

        <div class="shape s3" style="left:10%; top:55%;" onclick="pickShape()"><img src="shape01.gif"></div>
        <div class="shape s4" style="left:40%; top:52%;" onclick="pickShape()"><img src="shape02.gif"></div>
        <div class="shape s1" style="left:78%; top:50%;" onclick="pickShape()"><img src="shape04.gif"></div>

        <div class="shape s2" style="left:5%; top:76%;" onclick="pickShape()"><img src="shape04.gif"></div>
        <div class="shape s3" style="left:62%; top:80%;" onclick="pickShape()"><img src="shape03.gif"></div>

      </div>
    </div>
  </section>

  <!-- STEP 4 -->
  <section class="screen" id="step-4">
    <div class="top-star"><img src="star.png"></div>
    <div class="top-visual"><img src="q04.gif" class="top-gif"></div>
    <div class="loader"></div>
  </section>

  <!-- STEP 5 결과 페이지 -->
  <section class="screen" id="step-5">
    <div class="top-star"><img src="star.png"></div>

    <div class="quote" id="quote-text"></div>

    <div class="result-logo"><img src="logo.png"></div>

    <div class="result-buttons">
      <button class="btn" onclick="openBookLink()">문장이 담긴 책 보기</button>
      <button class="btn btn-secondary" onclick="saveImage()">저장하기</button>
    </div>
  </section>

  <div class="logo-area"><img src="logo.png"></div>
  <div class="bottom-gradient"></div>
</div>

<!-- 저장 이미지 -->
<div id="save-layout">
  <div id="save-quote"></div>
  <div id="save-logo"><img src="logo.png"></div>
</div>

<script>
  let sentences = [];
  let currentSentence = "";

  function loadSentences(){
    fetch("pp100.csv")
      .then(r=>r.text())
      .then(text=>{
        sentences = text.split("\n").map(s=>s.trim()).filter(s=>s.length>0);
      });
  }

  function goToStep(n){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(`step-${n}`).classList.add("active");

    const app=document.querySelector(".app");

    if(n===3 || n===5) app.classList.add("no-scroll");
    else app.classList.remove("no-scroll");

    if(n===5) app.classList.add("hide-logo");
    else app.classList.remove("hide-logo");

    app.scrollTop=0;
  }

  function pickShape(){
    goToStep(4);
    setTimeout(showResult,3000);
  }

  function showResult(){
    if(sentences.length===0){
      currentSentence="문장을 불러오는 중입니다.";
    } else {
      const i=Math.floor(Math.random()*sentences.length);
      currentSentence=sentences[i];
    }

    document.getElementById("quote-text").textContent=currentSentence;
    document.getElementById("save-quote").textContent=currentSentence;

    goToStep(5);
  }

  function openBookLink(){
    window.open("https://yozmsa.com/shop/?idx=50","_blank");
  }

  function saveImage(){
    const node=document.getElementById("save-layout");
    html2canvas(node,{scale:3,useCORS:true}).then(canvas=>{
      const link=document.createElement("a");
      link.href=canvas.toDataURL("image/png");
      link.download="지속하는힘_오늘의문장.png";
      link.click();
    });
  }

  window.addEventListener("load", loadSentences);
</script>

</body>
</html>
